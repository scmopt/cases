<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>cases - Economic Planning</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../styles.css">
<meta property="og:title" content="cases - Economic Planning">
<meta property="og:description" content="">
<meta property="og:site-name" content="cases">
<meta name="twitter:title" content="cases - Economic Planning">
<meta name="twitter:description" content="">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">cases</span>
    </a>
  </div>
        <div class="quarto-navbar-tools ms-auto">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../economic_planning/economic_planning.html">economic_planning</a></li><li class="breadcrumb-item"><a href="../economic_planning/economic_planning.html">Economic Planning</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">cases</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../core.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">core</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../agricultural_pricing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Agricultural Pricing</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">drone_network</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../drone_network/drone_network.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Drone-Network Design Queueing Model</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">economic_planning</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../economic_planning/economic_planning.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Economic Planning</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">efficiency_analysis</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../efficiency_analysis/efficiency_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Efficiency Analysis</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#problem-description" id="toc-problem-description" class="nav-link active" data-scroll-target="#problem-description">Problem Description</a></li>
  <li><a href="#model-formulation" id="toc-model-formulation" class="nav-link" data-scroll-target="#model-formulation">Model Formulation</a>
  <ul class="collapse">
  <li><a href="#sets-and-indices" id="toc-sets-and-indices" class="nav-link" data-scroll-target="#sets-and-indices">Sets and indices</a></li>
  <li><a href="#parameters" id="toc-parameters" class="nav-link" data-scroll-target="#parameters">Parameters</a></li>
  <li><a href="#decision-variables" id="toc-decision-variables" class="nav-link" data-scroll-target="#decision-variables">Decision Variables</a></li>
  <li><a href="#constraints" id="toc-constraints" class="nav-link" data-scroll-target="#constraints">Constraints</a></li>
  <li><a href="#objective-function" id="toc-objective-function" class="nav-link" data-scroll-target="#objective-function">Objective Function</a></li>
  </ul></li>
  <li><a href="#python-implementation" id="toc-python-implementation" class="nav-link" data-scroll-target="#python-implementation">Python Implementation</a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/scmopt/cases/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Economic Planning</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<section id="problem-description" class="level2">
<h2 class="anchored" data-anchor-id="problem-description">Problem Description</h2>
<p>In this problem, we assume that we have an economy with three types of industries:</p>
<ul>
<li>Coal</li>
<li>Steel</li>
<li>Transport</li>
</ul>
<p>Part of the outputs from these industries are needed as inputs to others. For example, coal is needed to fire the blast furnaces that produce steel, steel is needed in the machinery for extracting coal, etc. We measure all units of production in monetary terms. That is, each dollar of production by one of the industries requires inputs (in dollars) from possibly its own industry as well as other industries. The required inputs as well as the labor requirements (also measured in dollars) are shown in the following table.</p>
<table class="table">
<thead>
<tr class="header">
<th>input (t) / <br> output (t+1)</th>
<th>Coal</th>
<th>Steel</th>
<th>Transport</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Coal</td>
<td>0.1</td>
<td>0.5</td>
<td>0.4</td>
</tr>
<tr class="even">
<td>Steel</td>
<td>0.1</td>
<td>0.1</td>
<td>0.2</td>
</tr>
<tr class="odd">
<td>Transport</td>
<td>0.2</td>
<td>0.1</td>
<td>0.2</td>
</tr>
<tr class="even">
<td>Labor</td>
<td>0.6</td>
<td>0.3</td>
<td>0.2</td>
</tr>
<tr class="odd">
<td><strong>Total</strong></td>
<td><strong>1</strong></td>
<td><strong>1</strong></td>
<td><strong>1</strong></td>
</tr>
</tbody>
</table>
<p>There is a time lag in the economy so that the output in year t +1 requires an input in year t. For example, to produce one-dollar worth of coal requires 0.1 dollars of coal (to provide the necessary power), 0.1 dollars of steel (the steel ‘used up’ in the ‘wear and tear’ on the machinery) and 0.2 dollars of transport (for moving the coal from the mine). In addition, 0.6 dollars of manpower is required. Similarly, the other columns of the table give the inputs required (in dollars) for each dollar of steel and each dollar of transport (trucks, cars, trains, etc.). Notice that the value of each unit of output is exactly matched by the sum of the values of its inputs.</p>
<p>Output from an industry may also be used to build productive capacity for itself or other industries in future years. The inputs required to give unit increases (capacity in dollars’ worth of extra production) in productive capacity are given in the following table. Input from an industry in year t results in a (permanent) increase in productive capacity in year t +2.</p>
<table class="table">
<thead>
<tr class="header">
<th>input (t) / <br> output (t+2)</th>
<th>Coal</th>
<th>Steel</th>
<th>Transport</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Coal</td>
<td>0.1</td>
<td>0.7</td>
<td>0.9</td>
</tr>
<tr class="even">
<td>Steel</td>
<td>0.1</td>
<td>0.1</td>
<td>0.2</td>
</tr>
<tr class="odd">
<td>Transport</td>
<td>0.2</td>
<td>0.1</td>
<td>0.2</td>
</tr>
<tr class="even">
<td>Labor</td>
<td>0.4</td>
<td>0.2</td>
<td>0.1</td>
</tr>
</tbody>
</table>
<p>Stocks of goods may be held from year to year. At present (the beginning of year 1), the stocks and productive capacities (per year) are given in the following table (in millions of dollars).</p>
<table class="table">
<thead>
<tr class="header">
<th>Present</th>
<th>Stocks</th>
<th>Productive Capacity</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Coal</td>
<td>150</td>
<td>300</td>
</tr>
<tr class="even">
<td>Steel</td>
<td>80</td>
<td>350</td>
</tr>
<tr class="odd">
<td>Transport</td>
<td>100</td>
<td>280</td>
</tr>
</tbody>
</table>
<p>We want to maximize the total manpower utilization i.e.&nbsp;employment, over the planning horizon while meeting an exogenous consumption requirement in every year:</p>
<ul>
<li>60 million dollars of coal.</li>
<li>60 million dollars of steel.</li>
<li>30 million dollars of transport.</li>
</ul>
</section>
<section id="model-formulation" class="level2">
<h2 class="anchored" data-anchor-id="model-formulation">Model Formulation</h2>
<p>A widely used type of national economic model is the input–output model representing the interrelationships between the different sectors of a country’s economy. Such models are often referred to as dynamic Leontief models after their originator, who built such a model of the American economy. A similar model has been considered by Wagner (1957).</p>
<section id="sets-and-indices" class="level3">
<h3 class="anchored" data-anchor-id="sets-and-indices">Sets and indices</h3>
<p><span class="math inline">\(i,j \in \text{Industries}=\{\text{coal}, \text{steel}, \text{transport}\}\)</span></p>
<p>$ t = {, , , , , }$</p>
<p>$ t = {, , , , }$</p>
<p>$t H_{2,4} = {year2, year3, year4 } $</p>
</section>
<section id="parameters" class="level3">
<h3 class="anchored" data-anchor-id="parameters">Parameters</h3>
<p><span class="math inline">\(\text{demand}_{j} \in \mathbb{R}^+\)</span>: Exogenous demand of goods in industry <span class="math inline">\(j\)</span>.</p>
<p><span class="math inline">\(\text{initial_stock}_{j} \in \mathbb{R}^+\)</span>: Stocks of goods in industry <span class="math inline">\(j\)</span> available at the beginning of year 1.</p>
<p><span class="math inline">\(\text{in_out_prod}_{i,j} \in \mathbb{R}^+\)</span>: Input of good <span class="math inline">\(i\)</span> required to produce one unit of good <span class="math inline">\(j\)</span> in the following year.</p>
<p><span class="math inline">\(\text{in_out_cap}_{i,j} \in \mathbb{R}^+\)</span>: Input of good <span class="math inline">\(i\)</span> in current year results in a permanent increase in productive capacity of good <span class="math inline">\(j\)</span> two years later.</p>
<p><span class="math inline">\(\text{industry_cap}_{j} \in \mathbb{R}^+\)</span>: Industry <span class="math inline">\(j\)</span> productive capacity at the beginning of year 1.</p>
<p><span class="math inline">\(\text{labor_prod}_{j} \in \mathbb{R}^+\)</span>: Labor requirements for the production of goods in industry <span class="math inline">\(j\)</span>.</p>
<p><span class="math inline">\(\text{labor_extra_cap}_{j} \in \mathbb{R}^+\)</span>: Labor requirements to permanently increase capacity for goods in industry <span class="math inline">\(j\)</span>.</p>
</section>
<section id="decision-variables" class="level3">
<h3 class="anchored" data-anchor-id="decision-variables">Decision Variables</h3>
<p><span class="math inline">\(\text{production}_{j,t} \in \mathbb{R}^+\)</span>: Production of goods in industry <span class="math inline">\(j\)</span> available at year <span class="math inline">\(t\)</span>, in millions of dollars. Note: goods of industry j, in millions of dollars, available in year t but produced in previous year.</p>
<p><span class="math inline">\(\text{stock}_{j,t} \in \mathbb{R}^+\)</span>: Stock level of industry <span class="math inline">\(j\)</span> at the end of year <span class="math inline">\(t\)</span>, in millions of dollars.</p>
<p><span class="math inline">\(\text{extra_cap}_{j,t} \in \mathbb{R}^+\)</span>: Extra capacity for industry <span class="math inline">\(j\)</span> becoming effective at the beginning of year <span class="math inline">\(t\)</span>, in millions of dollars.</p>
<p>In order to build a realistic model, we need to think beyond year 5. Therefore, we make the following assumptions:</p>
<ul>
<li>External demand is constant up to year 5 and beyond.</li>
<li>Stock level remains constant at year 5 and beyond.</li>
<li>Capacity cannot be increased after year 5.</li>
</ul>
<p>Consequently, for year 6 and beyond, we can assume a static model of the economy. For this static model, the production of goods in each industry <span class="math inline">\(i \in \text{Industries}\)</span> can be computed as follows.</p>
<p><span class="math display">\[\begin{equation}
x_{i} = \text{demand}_{i} + \sum_{j \in \text{Industries} } \text{in_out_prod}_{i,j} * x_{j}
\end{equation}\]</span></p>
<p>Where <span class="math inline">\(x_{i}\)</span> is the production of goods in industry <span class="math inline">\(i\)</span>.</p>
<p>Solving this system of equations gives lower bounds for the production of goods in years beyond year 5. Then, the production of goods of industry <span class="math inline">\(j \in \text{Industries}\)</span> in year 6 and beyond can be defined by the following constraints.</p>
<p><span class="math display">\[
\text{production}_{j,t} \geq x_{j} \quad \forall j \in \text{Industries}, \; t=6.
\]</span></p>
<p><span class="math display">\[
\text{extra_cap}_{j,t} = 0 \quad \forall j \in \text{Industries}, \; t=6.
\]</span></p>
</section>
<section id="constraints" class="level3">
<h3 class="anchored" data-anchor-id="constraints">Constraints</h3>
<p><strong>Balance equation year 1</strong>: The initial stocks in industry <span class="math inline">\(i\)</span> should be equal to the total demand (internal and external), plus the extra capacity to build, plus the stock level at the end of year 1 of the goods in that industry.</p>
<p><span class="math display">\[\begin{equation}
\text{initial_stock}_{i} = \sum_{j \in \text{Industries} } \text{in_out_prod}_{i,j}*\text{production}_{j,2}
+ \text{demand}_{i} + \sum_{j \in \text{Industries} } \text{in_out_cap}_{i,j}*\text{extra_cap}_{j,3} +
\text{stock}_{i,1}
\end{equation}\]</span></p>
<p><strong>Balance equation for year 2, year 3, year 4</strong>: The production of goods in industry <span class="math inline">\(i\)</span> at year t plus the stocks at the end of year t-1 should be equal to the total demand (internal and external), plus the extra capacity to build, plus the stock level at the end of year t of the goods in that industry.</p>
<p><span class="math display">\[\begin{equation}
\text{production}_{j,t} + \text{stock}_{i,t-1} =
\sum_{j \in \text{Industries} } \text{in_out_prod}_{i,j}*\text{production}_{j,t+1} + \text{demand}_{i} +
\sum_{j \in \text{Industries} } \text{in_out_cap}_{i,j}*\text{extra_cap}_{j,t+2}
+ \text{stock}_{i,t} \quad \forall t \in H_{2,4}
\end{equation}\]</span></p>
<p><strong>Balance equation year 5</strong>: The production of goods in industry <span class="math inline">\(i\)</span> plus the stocks at the end of year 4 should be equal to the total demand (internal and external), plus the stock level at the end of year 5 of the goods in that industry.</p>
<p><span class="math display">\[\begin{equation}
\text{production}_{j,5} + \text{stock}_{i,4} =
\sum_{j \in \text{Industries} } \text{in_out_prod}_{i,j}*\text{production}_{j,6}  +
\text{demand}_{i} + \text{stock}_{i,5}
\end{equation}\]</span></p>
<p><strong>End of horizon constraints</strong>:</p>
<p><span class="math display">\[
\text{production}_{j,t} \geq x_{j} \quad \forall j \in \text{Industries}, \; t=6
\]</span></p>
<p><span class="math display">\[
\text{extra_cap}_{j,t} = 0 \quad \forall j \in \text{Industries}, \; t=6
\]</span></p>
<p>Where <span class="math inline">\(x_{j}\)</span> is the solution of the static model.</p>
<p><strong>Productive capacity constraints</strong>: These constraints ensure that the production of goods for each industry <span class="math inline">\(j\)</span> during the planning horizon do not exceed the total production capacity at that year.</p>
<p><span class="math display">\[\begin{equation}
\text{production}_{j,t} \leq \text{base_cap}_{j} + \sum_{\tau \leq t} \text{extra_cap}_{j,\tau} \quad \forall t \in \text{Horizon}
\end{equation}\]</span></p>
</section>
<section id="objective-function" class="level3">
<h3 class="anchored" data-anchor-id="objective-function">Objective Function</h3>
<p><strong>Labor utilization</strong>: Maximize labor employment.</p>
<p><span class="math display">\[\begin{equation}
\text{Maximize} \quad Z =
\sum_{t \in \text{fiveYears} } \sum_{j \in \text{Industries} } \text{labor_prod}_{j}*\text{production}_{j,t} +
\sum_{t \in \text{fiveYears} } \sum_{j \in \text{Industries} } \text{labor_extra_cap}_{j}*\text{extra_cap}_{j,t}
\end{equation}\]</span></p>
<hr>
</section>
</section>
<section id="python-implementation" class="level2">
<h2 class="anchored" data-anchor-id="python-implementation">Python Implementation</h2>
<p>We import the Gurobi Python Module and other Python libraries.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>